<template>
	<view>
		<swiper :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'" :vertical="true" @animationfinish="animationfinish" @change="change" :current="current" :indicator-dots="false" @touchstart="mpTouchstart" @touchend="mpTouchend">
			<swiper-item v-for="(list,index) in dataList" :key="index">
				<view v-if="isChange">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						
						 -->
						 <video
						 v-if="isShow"
						 :id="list._id+'_'+index"
						 :loop="true"
						 :muted="list.isplay"
						 :controls="false"
						 :http-cache="true"
						 :page-gesture="false"
						 :show-fullscreen-btn="false"
						 :show-loading="false"
						 :show-center-play-btn="false"
						 :enable-progress-gesture="false"
						 :src="list.src"
						 @ended="ended"
						 @click="tapVideoHover(list.state,$event)"
						 :style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'"
						 :poster="list.img"
						 ></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
						<image
						v-if="!list.playIng"
						:src="list.img"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'"
						mode="aspectFit"
						></image>
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)" :style="'width: '+ windowWidth +'px; height: '+ cccHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" src="@/static/play.png"></image>
					</view>
					<view class="userInfo">
						<!-- 1.å¤´åƒ -->
						<!-- <image @click="tozuozhe" class="userAvatar" :src="list.href" mode="aspectFill"></image> -->
						<!-- 2.ç‚¹èµ -->
						<view @click="cLike(list.like);" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list.like" src="@/static/aixin.png" style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<image v-if="!list.like" src="@/static/aixinRed.png" style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<text style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;" :class="{'likeNumActive':list.like}">{{list.like_n}}</text>
						</view>
						<!-- 3.è¯„è®º -->
						<view class="comment" @click="toComment(index)" style="opacity: 0.9; margin-top: 17px;">
							<image src="" style="width: 35px; height: 35px; position: absolute; right: 7px;"></image>
							<text style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">{{list.sms_n}}</text>
						</view>
						<!-- 4.åˆ†äº« -->
						<view @click="share" style="opacity: 0.9; margin-top: 17px;">
							<image src="" style="width: 40px; height: 40px; position: absolute; right: 5px;"></image>
							<text style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 40px;">åˆ†äº«</text>
						</view>
					</view>
					<!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
					<view class="content">
						<text class="userName" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.title}}</text><!-- i={{i}} -->
						<text class="words" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.msg}}</text><!-- k={{k}} -->
						<text class="words" @click.stop="detail(list.id,list.mid)" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.namets}}</text><!-- k={{k}} -->
					</view>
				</view>
				<view v-if="Math.abs(k-index)<=1&&!isChange">
					<view>
						<!-- 
						1.v-ifï¼šç”¨äºæ§åˆ¶è§†é¢‘åœ¨èŠ‚ç‚¹çš„æ¸²æŸ“æ•°
						2.mutedçš„é»˜è®¤å€¼æ˜¯ falseï¼Œä»£è¡¨é»˜è®¤æ˜¯ç¦éŸ³è§†é¢‘çš„
						3.http-cacheé»˜è®¤å¼€å¯è§†é¢‘ç¼“å­˜
						4.posterï¼ˆå°é¢ï¼ˆæ–¹æ¡ˆä¸€ï¼‰ï¼‰ï¼šè¿™é‡Œçš„å°é¢é»˜è®¤å¤„ç†å­˜å‚¨åœ¨é˜¿é‡Œäº‘çš„è§†é¢‘
						5.show-loadingï¼šè¿™é‡Œé»˜è®¤å»æ‰æ’­æ”¾è½¬åœˆçš„æ ‡å¿—
						 -->
						<video
						v-if="isShow"
						:id="list._id+''+index"
						:loop="true"
						:muted="list.isplay"
						:controls="controls"
						:show-play-btn="true"
						:http-cache="true"
						:page-gesture="false"
						:show-fullscreen-btn="false"
						:show-loading="false"
						:show-center-play-btn="false"
						:enable-progress-gesture="false"
						:src="list.src"
						@timeupdate="timeupdate"
						@ended="ended"
						@click="tapVideoHover(list.state,$event)"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; background-color: #000000;'"
						
						></video>
						<!-- 
						1.è¿™é‡Œæ˜¯å°é¢ï¼ˆæ–¹æ¡ˆäºŒï¼‰ï¼šè¿™é‡Œçš„å°é¢å¯ä»¥è‡ªå®šä¹‰ã€‚
						2.ä¹Ÿåœ¨ä»£ç ä¸­åšäº†æ‰¹æ³¨ï¼Œä¸¤ç§æ–¹æ¡ˆå¯ä»¥å…±å­˜ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚
						-->
						<!-- <image
						v-if="!list.playIng"
						:src="list.img"
						:style="'width: '+ windowWidth +'px; height: '+ windowHeight +'px; position: absolute;'"
						mode="aspectFit"
						></image> -->
					</view>
					<!-- æ’­æ”¾çŠ¶æ€ï¼špause çš„æ—¶å€™å°±ä¼šæš‚åœ -->
					<view class="videoHover" @click="tapVideoHover(list.state,$event)" :style="'width: '+ windowWidth +'px; height: '+ cccHeight +'px;'">
						<image v-if="list.state=='pause'" class="playState" src="@/static/play.png"></image>
					</view>
					<view class="userInfo">
						<!-- 1.å¤´åƒ -->
						<!-- <image @click="tozuozhe" class="userAvatar" :src="list.href" mode="aspectFill"></image> -->
						<!-- 2.ç‚¹èµ -->
						<view @click="cLike(list.like,list.pid,list.mid);" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list.like*1==1" src="@/static/aixin.png" style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<image v-if="list.like*1==2" src="@/static/aixinRed.png" style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<text style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; margin-top: 40px; font-weight: bold;" :class="{'likeNumActive':list.like}">{{list.like_n}}</text>
						</view>
						<!-- 3.åˆ†äº« -->
						<view @click="share" style="opacity: 0.9; margin-top: 17px;">
							<image src="@/static/share-fill.png" style="width: 40px; height: 40px; position: absolute; right: 5px;"></image>
							<text style="color: #FFFFFF; margin-top: 5px; font-size: 14px; text-align: center; font-weight: bold; margin-top: 40px;">åˆ†äº«</text>
						</view>
						<!-- 4.è¯„è®º -->
						<view class="comment" @click="toComment(list.like,list.pid,list.mid)" style="opacity: 0.9; margin-top: 17px;">
							<image v-if="list.iszj*1==1" src="@/static/sc.png" style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<image v-if="list.iszj*1==2" src="@/static/scRed.png" style="width: 40px; height: 40px; position: absolute; right: 6px;"></image>
							<text v-if="list.iszj*1==1"  style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">è¿½å‰§</text>
							<text v-if="list.iszj*1==2" style="color: #FFFFFF; margin-top: 5px; font-size: 14px; font-weight: bold; text-align: center; margin-top: 40px;">å·²è¿½</text>
						</view>
						
					</view>
					<!-- æœ€åº•ä¸‹çš„æ–‡å­—éƒ¨åˆ† -->
					<view class="content">
						<text class="userName" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.title}}</text><!-- i={{i}} -->
						<text class="wordss" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.msg}}</text><!-- k={{k}} -->
						<text class="words" @click.stop="sellxj()" :style="'width: '+ (windowWidth - 90) +'px;'">{{list.namets}}</text><!-- k={{k}} -->
					</view>
				</view>
			</swiper-item>
		</swiper>
		<uni-popup type="bottom" ref="select">
			<view v-if="fenji==1" :style="'width: '+ windowWidth +'px; height: '+ (windowHeight/1.6) +'px; background-color: #202020; border-top-left-radius: 10px; border-top-right-radius: 10px;'">
				<view :style="'width: '+ windowWidth +'px; height: 35px;'">
					<view style="display: flex; flex-direction: row;">
						<view style="display: flex; flex-direction: column;">
							<view style="display: flex; flex-direction: row;">
								<image src="@/static/img/index/layers.png" style="width: 20px; height: 20px; margin-top: 10px; margin-left: 20px;"></image>
								<view :style="'font-size: 16px; font-weight: bold; color: #FFFFFF; margin-top: 9px; height: 22px; margin-left: 20px; width: '+ (windowWidth*0.6) +'px; overflow: hidden;'">
									å½“å‰æ’­æ”¾ç¬¬{{ Number(k+1) }}ä¸ªè§†é¢‘
								</view>
							</view>
							<!-- <view :style="'font-size: 12px; color: #FFFFFF; margin-top: 2px; height: 18px; margin-left: 20px; opacity: 0.6; width: '+ (windowWidth*0.6) +'px; overflow: hidden;'">è¿™æ˜¯ç¬¬{{ Number(k+1) }}ä¸ªè§†é¢‘</view> -->
						</view>
						<image @click="down" src="@/static/img/index/down.png" style="width: 30px; height: 30px; margin-top: 5px; position: absolute; right: 20px;"></image>
					</view>
				</view>
				<scroll-view :style="'width: '+ (windowWidth) +'px; height: '+ ((windowHeight/1.6)*0.85) +'px;'" :scroll-y="true" :scroll-top="scrollTop">
					<block v-for="(list,index) in dataList">
						<view @click="selectThisVideo(index)" :style="'width: '+ (windowWidth) +'px; display: flex; flex-direction: row;'">
							<image :src="list.img"
							mode="aspectFill" style="width: 70px; height: 80px; margin-top: 15px; margin-left: 15px; border-radius: 5px;"></image>
							<view style="display: flex; flex-direction: column; margin-top: 15px; margin-left: 10px;">
								<view style="display: flex; flex-direction: row;">
									<view style="font-size: 18px; color: #FFFFFF; font-weight: bold;">{{list.name}}</view>
									<image v-if="list.pays*1==1" src="@/static/shilu-login/2.png" style="width: 50rpx; height: 50rpx; margin-left: 20rpx;"></image>
								</view>
								<view :style="'font-size: 16px; color: #FFFFFF; margin-top: 5px; width: '+ (windowWidth*0.7) +'px; overflow: hidden;'">{{list.title}}</view>
								<view :style="'font-size: 16px; color: #FFFFFF; margin-top: 5px; width: '+ (windowWidth*0.7) +'px; overflow: hidden; opacity: 0.6;'">{{list.msg}}</view>
							</view>
						</view>
					</block>
					<view @click="getMoreSelectVideo" :style="'width: 100px; height: 40px; border: 1px #FFFFFF solid; border-radius: 40px; margin-top: 30px; margin-left: '+ (windowWidth*0.38) +'px; opacity: 0.6;'">
						<view v-if="!datareload" style="font-size: 14px; font-weight: bold; color: #FFFFFF; text-align: center; padding-top: 10px;">è·å–æ›´å¤š</view>
						<view v-if="datareload" style="font-size: 14px; font-weight: bold; color: #FFFFFF; text-align: center; padding-top: 10px;">æ²¡æœ‰æ•°æ®äº†</view>
					</view>
					<view style="width: 1px; height: 1px; margin-top: 30px;"></view>
				</scroll-view>
			</view>
			<view v-if="fenji==2" :style="'width: '+ windowWidth +'px; height:500rpx; background-color: #202020; border-top-left-radius: 10px; border-top-right-radius: 10px;'">
				<view :style="'width: '+ windowWidth +'px; height: 35px;'">
					<view style="display: flex; flex-direction: row;">
						<view style="display: flex; flex-direction: column;">
							<view style="display: flex; flex-direction: row;">
								<image src="@/static/shilu-login/2.png" style="width: 20px; height: 20px; margin-top: 10px; margin-left: 20px;"></image>
								<view :style="'font-size: 16px; font-weight: bold; color: #FFFFFF; margin-top: 9px; margin-left: 20px; height: 22px;  width: '+ (windowWidth*0.6) +'px; overflow: hidden;'">
									å½“å‰ç¬¬{{ Number(k+1) }}ä¸ªè§†é¢‘ æ²¡æœ‰æƒé™æ’­æ”¾
								</view>
							</view>
							<!-- <view :style="'font-size: 12px; color: #FFFFFF; margin-top: 2px; height: 18px; margin-left: 20px; opacity: 0.6; width: '+ (windowWidth*0.6) +'px; overflow: hidden;'">è¿™æ˜¯ç¬¬{{ Number(k+1) }}ä¸ªè§†é¢‘</view> -->
						</view>
						<image @click="downbuy" src="@/static/img/index/down.png" style="width: 30px; height: 30px; margin-top: 5px; position: absolute; right: 20px;"></image>
					</view>
				</view>
				<view style="padding: 30rpx;">
					<view @click="buyAct(0)" class="gdfgjh">è´­ä¹°æ•´éƒ¨è§†é¢‘</view>
					<view @click="buyAct(1)" class="gdfgjh">è´­ä¹°å•é›†è§†é¢‘</view>
					<view @click="govip()" class="gdfgjh">å¼€é€šä¼šå‘˜</view>
				</view>
			</view>
		</uni-popup>
		<uni-popup ref="sharepopup" type="bottom">
		    <share-btn :sharedataTemp="sharedata"></share-btn>
		</uni-popup>	
	</view>
</template>

<script>
	// import userList from '../new_index/data.js'//è¿™ä¸ªæ˜¯å‡æ•°æ®
	import configs from "@/common/config.js"
	import shareBtn from '@/components/share-btn/share-btn.vue';
	let audo = uni.createInnerAudioContext()
	audo.loop = true
	export default {
		components: {
			shareBtn
		},
		data() {
			return {
				sharedata: {
					type: 2,
					strShareUrl: "",
					strShareTitle: "åˆ†äº«æ ‡é¢˜",
					strShareSummary: "åˆ†äº«æ€»ç»“",
					strShareImageUrl: ""
				},
				
				vid: 0,
				mid: 0,
				videodata:[],
				page: 1,
				windowWidth: 0,
				windowHeight: 0,
				cccHeight:0,
				platform: "",
				deleteHeight: 0,
				dataList: [],
				k: 0,
				fenji: 1,
				oldVideo: "",
				voice: "",
				timeout: "",
				current: 0,
				boxStyle:{//è§†é¢‘ï¼Œå›¾ç‰‡å°é¢æ ·å¼ğŸŒŸğŸ’—
					'height': 0,
					'width': 0,
				},
				urls:configs.webUrl,
				isAutoplay: true,//æ˜¯å¦å¼€å¯è‡ªåŠ¨æ’­æ”¾(é»˜è®¤ä¸å¼€å¯)
				autoplayText: "å¼€å¯è‡ªåŠ¨æ’­æ”¾",
				thisindex: 0,
				isChange: true,
				controls: true,
				isShow: false,
				
				changeTimeout: "",
				mptime: 0,
				mpstartTime: 0,
				
				isClick: false,
				sharesa: false,
				datareload: false,
				total: 0,
				duration: 500,
				scrollTop: 0,
			}
		},
		watch:{
			async k(k,old_k){
				console.log(k)
				this.isShow = false;
				this.dataList[old_k].playIng = false//å¦‚æœè§†é¢‘æš‚åœï¼Œå°±åŠ è½½å°é¢
				this.dataList[old_k].isplay = true
				this.dataList[old_k].state = 'pause'
				console.log('é¢„ç•™ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[old_k]._id+''+old_k)
				uni.createVideoContext(this.dataList[old_k]._id + '' + old_k,this).stop()//å¦‚æœè§†é¢‘æš‚åœï¼Œé‚£ä¹ˆæ—§è§†é¢‘åœæ­¢ï¼Œè¿™é‡Œçš„this.dataList[old_k]._id + '' + old_kï¼Œåé¢åŠ  old_k æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªè§†é¢‘çš„ id å€¼ä¸åŒï¼Œè¿™æ ·å°±å¯ä»¥å¤§ç¨‹åº¦çš„é¿å…ä¸²éŸ³é—®é¢˜
				console.log('å·²ç»æš‚åœ --> ç¬¬' + (old_k + 1) + 'ä¸ªè§†é¢‘ï½')//æç¤º
				this.dataList[k].state = 'play'
				this.isShow = true;
				// #ifdef MP
				// å¦‚æœæ˜¯å°ç¨‹åºç«¯
				clearTimeout(this.changeTimeout);
				
				this.dataList[k].isplay = false
				setTimeout(()=>{
					this.dataList[k].playIng = true
				},100)
				if(this.mptime < 0.2){
					this.changeTimeout = setTimeout(()=>{
						uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
					},250)
				} else {
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
				}
				// #endif
				// #ifdef H5
				this.dataList[k].isplay = true
				audo.src = this.dataList[k].src
				if(this.isClick){
					setTimeout(()=>{
						if (typeof WeixinJSBridge == "undefined") {
							setTimeout(()=>{
								audo.play()
								uni.createVideoContext(this.dataList[k]._id+''+k,this).seek(0)
								uni.createVideoContext(this.dataList[k]._id+''+k,this).play()
								setTimeout(()=>{
									this.dataList[k].playIng = true
								},650)
							},500)
						} else {
							WeixinJSBridge.invoke('getNetworkType', {}, e => {
								setTimeout(()=>{
									audo.play()
									uni.createVideoContext(this.dataList[k]._id+''+k,this).seek(0)
									uni.createVideoContext(this.dataList[k]._id+''+k,this).play()
									setTimeout(()=>{
										this.dataList[k].playIng = true
									},850)
								},200)
							})
						}
					},200)
				} else {
					audo.pause()
					this.dataList[k].state = 'pause'
					uni.createVideoContext(this.dataList[k]._id+''+k,this).seek(0)
					uni.createVideoContext(this.dataList[k]._id+''+k,this).pause()
				}
				// #endif
				var p = k+1;
				//console.log('é¢„åŠ è½½ç¬¬' + (p + 1) + 'ä¸ªè§†é¢‘ï¼š' + this.dataList[p]._id+''+p)
			}
		},
		onLoad(e) {
			if(e.vid){
				this.vid=e.vid
			}
			if(e.mid){
				this.mid=e.mid
			}
			// #ifdef MP-WEIXIN || APP-PLUS
			this.sharedata.strShareUrl='/pages/client/tuan/detail?vid='+this.vid+'&mid=0'
			// #endif
			// #ifdef H5
			this.sharedata.strShareUrl=this.urls+'/h5/#/pages/client/tuan/detail?vid='+this.vid+'&mid=0'
			// #endif
			
			var option={'page':1,'index':0,'option':0}
			this.platform = uni.getSystemInfoSync().platform
			var model = uni.getSystemInfoSync().model
			if(this.platform == 'ios' && (model !== 'iPhone6' || model !== 'iPhone6s' || model !== 'iPhone7' || model !== 'iPhone8')){
				this.deleteHeight = 50//æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
			}
			this.windowWidth = uni.getSystemInfoSync().windowWidth
			this.windowHeight = uni.getSystemInfoSync().windowHeight
			this.cccHeight = this.windowHeight-80
			this.boxStyle.width = this.windowWidth + 'px'//ç»™å®½åº¦åŠ px
			this.boxStyle.height = this.windowHeight - this.deleteHeight;//æœ‰ tabbarçš„ ä¿®æ”¹è¿™é‡Œå¯ä»¥æ”¹å˜è§†é¢‘é«˜åº¦
			this.thisindex = Number(option.index)
			this.get(option) //åˆšè¿›å…¥é¡µé¢åŠ è½½æ•°æ®
		},
		onShow(){
			console.log('å›åˆ°å‰å°');
			if(this.dataList.length !== 0){
				// #ifdef MP
				this.dataList[this.k].state = 'play';
				uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
				// #endif
				// #ifdef H5
				if(this.isClick){
					this.dataList[this.k].state = 'play';
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
					audo.play()
				}
				// #endif
			}
		},
		onHide(){
			// #ifdef MP
			this.dataList[this.k].state = 'pause';
			uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
			// #endif
			// #ifdef H5
			if(this.isClick){
				this.dataList[this.k].state = 'pause';
				uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
				audo.pause()
			}
			// #endif
			console.log('åˆ°åå°');
		},
		methods: {
			share(){
				this.$refs.sharepopup.open();
			},
			buyAct(mid){
				if(mid==1){
					mid = this.dataList[this.k].mid
				}
				var info=this.dataList[this.k]
				if(uni.getStorageSync("userinfo")){
					uni.setStorage({//ç¼“å­˜é…ç½®ä¿¡æ¯
						key: 'buydata',  
						data: info
					})
					uni.navigateTo({
						url:'/pages/client/tuan/buy?id='+this.id+'&mid='+mid
					})
				}else{
					this.denglu()
					return false
				}
			},
			govip(){
				if(uni.getStorageSync("userinfo")){
					uni.navigateTo({
						url:'/pages/client/vipcard/index'
					})
				}else{
					this.denglu()
					return false
				}
			},
			selectThisVideo(index){
				this.down();
				if(this.datareload){
					uni.showToast({
						title: "æ²¡æœ‰æ•°æ®äº†",
						icon: 'none',
						duration: 3000
					})
					return false
				}
				this.duration = 20;
				this.k = index;
				this.current=index
				setTimeout(()=>{
					this.duration = 500;
				},500)
			},
			getMoreSelectVideo(){
				this.GET();
			},
			down(){
				this.$refs.select.close();
			},
			downbuy(){
				this.$refs.select.close();
			},
			xunjiup(mid){
				this.sharesa = false;
				this.index=mid
			},
	
			sellxj() {
				this.fenji=1
				this.$refs.select.open('bottom');
				this.$nextTick(()=>{
					let num1 = (this.windowHeight/1.6)*0.85;
					let num2 = num1/4.78;
					this.scrollTop = num2 * Number(this.k);
				})
			},
			displayxj() {
				this.sharesa = false;
			},
			detail(vid,mid){
				uni.navigateTo({
					url:'/pages/client/tuan/detail?vid='+vid+'&mid='+mid
				})
			},
			mpTouchend(){
				this.mptime = (new Date()/1000) - this.mpstartTime;
			},
			mpTouchstart(){
				this.mpstartTime = (new Date()/1000);
			},
			autoPlay(){
				this.isAutoplay = !this.isAutoplay;
				if(!this.isAutoplay){
					this.autoplayText = "å¼€å¯è‡ªåŠ¨æ’­æ”¾"
					uni.showToast({
						title: "å…³é—­è‡ªåŠ¨æ’­æ”¾",
						icon: 'none',
						duration: 3000
					})
				} else {
					this.autoplayText = "å…³é—­è‡ªåŠ¨æ’­æ”¾"
					uni.showToast({
						title: "å¼€å¯è‡ªåŠ¨æ’­æ”¾",
						icon: 'none',
						duration: 3000
					})
				}
			},
			ended(){
				
				// 1.æ’­æ”¾å½“å‰è§†é¢‘ç»“æŸæ—¶è§¦å‘ï¼Œè‡ªåŠ¨åˆ‡æ¢ä¸‹ä¸€ä¸ªè§†é¢‘
				var idsdff=this.k+1
				if(this.isAutoplay && this.total>idsdff){
					this.current = idsdff
				}
			},
			timeupdate(event){
				// console.log(11111)
				// console.log(event.detail.currentTime)
				
				if(event.detail.currentTime>0 && this.dataList[this.k].pays==1){
					this.dataList[this.k].state = 'pause';
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).seek(0);
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause();
					this.fenji=2
					this.$refs.select.open('bottom');
				}
			},
			//ç‚¹å‡»æ’­æ”¾&&æš‚åœ
			tapVideoHover(state,event){
				this.controls = true;
				console.log('state--',state);
				console.log('event--',event);
				if(state=='play'||state=='continue'){
					this.dataList[this.k].state = 'pause';
				}else{
					this.dataList[this.k].state = 'continue';
				}
				if(this.dataList[this.k].state == 'continue'){
					this.isClick = true;
					this.dataList[this.k].playIng = true
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play();//æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = false
					// #endif
					// #ifdef H5
					audo.play()
					// #endif
				}
				if(this.dataList[this.k].state == 'pause'){
					uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause();//æš‚åœä»¥åç»§ç»­æ’­æ”¾
					// #ifdef MP
					this.dataList[this.k].isplay = true
					// #endif
					// #ifdef H5
					audo.pause()
					// #endif
				}
			},
			change(event){
				this.k = event.detail.current
			},
			animationfinish(event){
				// 1.è¿™é‡Œè¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªè§†é¢‘å°±è¿›å…¥ get() æ–¹æ³•åŠ è½½è§†é¢‘è¿›å…¥åˆ—è¡¨
				if(this.k == this.dataList.length - 1){
					this.GET()
				}
			},
			//æ¯ä¸€ç»„ç»“æŸæ—¶æ–°çš„è¯·æ±‚
			GET(){
				var uid=0;
				if(uni.getStorageSync("userinfo")){
					uid=uni.getStorageSync("userinfo").id
				}
				if(this.datareload){
					return false
				}
				uni.request({
					url: this.urls+'/api/video/videoinfo?page='+this.page+'&vid='+this.vid+'&mid='+this.mid+'&token='+uni.getStorageSync("userinfo").token,
					success: (res) => {
						this.page=this.page+1
						var msg = res.data.data
						// 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
						if(res.data.data.length>0){
							this.dataList = this.dataList.concat(res.data.data);
							console.log(res.data.data.length)
						}else{
							this.datareload=true
						}
						// for (let i = 0; i < msg.length; i++) {
						// 	this.dataList.push(msg[i])
						// }
					}
				})
			},
			get(options){
				var uid=0;
				if(uni.getStorageSync("userinfo")){
					uid=uni.getStorageSync("userinfo").id
				}
				uni.request({
					//url: this.urls+'/api/video/videoinfo?page='+this.page+'&uid='+uid,
					url: this.urls+'/api/video/videoinfo?page='+this.page+'&vid='+this.vid+'&mid='+this.mid+'&token='+uni.getStorageSync("userinfo").token,
					//url: 'https://bdb24c6d-8c19-4f80-8e7e-c9c9f037f131.bspapp.com/video',
					success: (res) => {
						this.page=this.page+1
						this.dataList = this.dataList.concat(res.data.data);
						this.total= res.data.total
						this.gets(options,this.dataList)
						// // 2.è¿™é‡ŒæŠŠè§†é¢‘æ·»åŠ åˆ°è§†é¢‘åˆ—è¡¨
						// for (let i = 0; i < msg.length; i++) {
						// 	this.dataList.push(msg[i])
						// }
					}
				})
				
			},
			async gets(options,dataList){
				// 1.è¿™é‡Œå¼•å…¥åç«¯è¯·æ±‚æ•°æ®
				// var msg = userList
				this.isShow = false;
				// this.dataList = uni.getStorageSync("dataList");
				console.log(options.option)
				this.current = Number(options.option);
				this.k = Number(options.option);
				await setTimeout(()=>{
					this.isChange = false
				},50)
				this.isShow = true;
				// #ifdef H5
				this.dataList[this.k].isplay = true
				// #endif
				// #ifdef MP
				// å¦‚æœæ˜¯å°ç¨‹åºç«¯
				
				// console.log(33333333333333333333333)
				// console.log(this.k)
				// console.log(this.dataList[this.k].isplay)
				this.dataList[this.k].isplay = false
				this.dataList[this.k].state = 'play'
				// #endif
				this.dataList[this.k].playIng = true
				if(Number(options.option) == 0){
					setTimeout(()=>{
						// #ifdef H5
						uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).seek(0)
						uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).pause()
						this.dataList[this.k].state = 'pause';
						audo.src = this.dataList[this.k].src;
						// #endif
						// #ifdef MP
						uni.createVideoContext(this.dataList[this.k]._id+''+this.k,this).play()
						// #endif
					},100)
				}
			},
			toComment(sss,vid,mid){
				if(uni.getStorageSync("userinfo")){
					
				}else{
					this.denglu()
					return false
				}
				const video = this.dataList[this.k];
				if(sss==1){
					this.dataList[this.k].iszj=2
				}else{
					this.dataList[this.k].iszj=1
				}
				
				let this_=this
				let data = {'vid':vid,'mid':mid};
				data.token = uni.getStorageSync("userinfo").token
				data.uid = uni.getStorageSync("userinfo").id
				uni.request({
					url: this_.urls+'/api/user/videorecord',
					data: data,
					success: data => {
						uni.showToast({
							icon:'none',
							title:data.data.msg
						})
					},
					fail: (data, code) => {
					}
				});
			},
			cLike(sss,vid,mid){
				if(uni.getStorageSync("userinfo")){
					
				}else{
					this.denglu()
					return false
				}
				const video = this.dataList[this.k];
				if(sss==1){
					this.dataList[this.k].like=2
					video.like_n += 1;
				}else{
					this.dataList[this.k].like=1
					video.like_n -= 1
				}
				
				console.log(vid)
				
				let this_=this
				let data = {'vid':vid,'mid':mid};
				data.token = uni.getStorageSync("userinfo").token
				data.uid = uni.getStorageSync("userinfo").id
				uni.request({
					url: this_.urls+'/api/user/tapLove',
					data: data,
					success: data => {
						uni.showToast({
							icon:'none',
							title:data.data.msg
						})
						// if(data.data.msg=='å–æ¶ˆæˆåŠŸ'){
						// 	video.like_n -= 1
						// }else{
						// 	video.like_n += 1;
						// }
					},
					fail: (data, code) => {
					}
				});
			},
			denglu(){
				uni.showModal({
					title: 'æ¸©é¦¨æç¤º',
					content: 'è¯·å…ˆç™»å½•',
					showCancel: true,
					confirmText: "ç™»å½•",
					success: function (res) {
						if (res.confirm) {
							uni.navigateTo({
								url:"/pages/login/login"
							})
						} else if (res.cancel) {
							//uni.navigateBack();
						}
					}
				});
				
			}
		}
	}
</script>

<style>
	.container {background-color: #000000;}
	.item {
		/* width : 750rpx; */
		background-color: #000000;
		position: relative;
	}
	.videoHover{
		position: absolute;
		top: 40px;
		left: 0;
		flex: 1;
		background-color: rgba(0,0,0,0.1);
		justify-content: center;
		align-items: center;
		
		/* border-style: dashed;
		border-color: #DD524D;
		border-width: 1px; */
	}
	.playState{
		width:  160rpx;
		height: 160rpx;
		opacity: 0.2;
	}
	.userInfo{
		position: absolute;
		bottom:30%;
		right: 10px;
		width: 100rpx;
		text-align: center;
		flex-direction: column;
		
	}
	.userAvatar{
		border-radius: 500%;
		margin-bottom: 15px;
		border-style: solid;
		border-width: 2px;
		border-color: #ffffff;
	}
	.userAvatar{
		width : 100rpx;
		height: 100rpx;
	}
	.likeIco,.shareIco,.commentIco{
		width : 60rpx;
		height: 60rpx;
		margin-top: 15px;
	}
	.likeNum,.commentNum,.shareTex{
		color: #ffffff;
		font-size: 30rpx;
		text-align: center;
		margin: 5px;
	}
	.likeNumActive{
		color: red;
	}
	.content{
	  width: 720rpx;
	  z-index: 99;
	  position: absolute;
	  bottom: 30px;
	  /* justify-content: center; */
	  padding: 15rpx;
	  flex-direction: column;
	  justify-content: flex-start;
	  color: #ffffff;
	}
	.userName {
	  font-size: 30rpx;
	  color: #ffffff;
	  margin-top: 80upx;
	  margin-left: -12rpx;
	}
	.words {
	  margin-top: 16rpx;
	  font-size: 30rpx;
	  color: #ffffff;
	  margin-bottom: 20rpx;
	}
	.wordss {
	  margin-top: 10rpx;
	  font-size: 26rpx;
	  color: #ffffff;
	}
	.root{
		background-color: #000000;
	}
	.xunji{
		width:100%;position:fixed;top:0;left:0;right:0;bottom:0;
	}
	.cover-view-lefts{
		/* max-height: 700rpx; */
		border-top-left-radius:40rpx; 
		border-top-right-radius:40rpx;
		position: absolute;
		width: 750rpx;
		bottom: 0px;
		padding: 10rpx 25rpx 25rpx 25rpx;
		z-index: 9999;
		font-size: 16px;
		color: #999;
		background: #FFFFFF;
		overflow:hidden;
	}
	.left-view{
		margin-bottom: 20upx;
	}
	.left-text{
		font-size: 16px;
		color: #FFFFFF;
	}
	.left-texta{
		font-size: 14px;
		color: #fff;
		width: 24%;
		padding: 20rpx 0px;
		text-align: center;
		float: left;
		border-radius: 10rpx;
		background: #DD524D;
		margin-bottom: 20rpx;
		position: relative;
	}
	.left-texta1{
		background: #dddddd;
	}
	.gdfgjh{
		font-size: 30rpx; 
		font-weight: 600; 
		line-height: 90rpx;
		background: #fff; 
		border-radius: 18rpx; 
		padding: 0 20rpx;
		text-align: center; 
		margin-bottom: 20rpx;
	}
</style>
